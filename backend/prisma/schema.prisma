generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
}

model User {
  id              Int         @id @default(autoincrement())
  username        String?     @unique(map: "ix_users_username") @db.VarChar(50)
  email           String?     @unique(map: "ix_users_email") @db.VarChar(100)
  hashed_password String?     @db.VarChar(255)
  role            users_role?
  mobile          String?     @unique @db.VarChar(15)
  area            String?     @db.VarChar(100)
  createdAt       DateTime    @default(now())

  @@index([id], map: "ix_users_id")
  @@map("users")
}

model Product {
  id          Int           @id @default(autoincrement())
  name        String        @unique
  category    String
  uom         String        @default("pcs")
  baseRate    Float
  status      String        @default("Active")
  createdAt   DateTime      @default(now())
  variants    Variant[]
  rateHistory RateHistory[]

  @@map("product")
}

model DailyProduction {
  id          Int               @id @default(autoincrement())
  date        String            @unique
  totalQty    Float             @default(0)
  totalWeight Float             @default(0)
  totalAmount Float             @default(0)
  entries     ProductionEntry[]
  createdAt   DateTime          @default(now())

  @@map("dailyproduction")
}

model ProductionEntry {
  id                Int             @id @default(autoincrement())
  dailyProductionId Int
  dailyProduction   DailyProduction @relation(fields: [dailyProductionId], references: [id])
  category          String
  itemName          String
  uom               String
  rate              Float
  qty               Float
  weight            Float
  amount            Float

  @@map("productionentry")
}

model DailyAlter {
  id          Int          @id @default(autoincrement())
  date        String       @unique
  totalQty    Float        @default(0)
  totalWeight Float        @default(0)
  totalAmount Float        @default(0)
  entries     AlterEntry[]
  createdAt   DateTime     @default(now())

  @@map("dailyalter")
}

model AlterEntry {
  id           Int        @id @default(autoincrement())
  dailyAlterId Int
  dailyAlter   DailyAlter @relation(fields: [dailyAlterId], references: [id])
  category     String
  itemName     String
  uom          String
  rate         Float
  qty          Float
  weight       Float
  amount       Float

  @@map("alterentry")
}

model Artisan {
  id        Int      @id @default(autoincrement())
  name      String
  mobile    String   @unique
  email     String?
  area      String?
  status    String   @default("Active")
  createdAt DateTime @default(now())

  @@map("artisan")
}

model Variant {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  name      String
  uom       String?
  baseRate  Float
  status    String   @default("Active")
  createdAt DateTime @default(now())

  @@map("variant")
}

model RateHistory {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  oldRate   Float
  newRate   Float
  remark    String?
  createdAt DateTime @default(now())

  @@map("ratehistory")
}


model WoolTransaction {
  id        Int      @id @default(autoincrement())
  date      String // YYYY-MM-DD
  batchId   String
  qty       Float
  issuedBy  String   @default("Admin")
  issuedTo  String // Tendor or Artisan Name/ID
  remarks   String?
  createdAt DateTime @default(now())

  @@map("wooltransaction")
}

model Invoice {
  id            Int      @id @default(autoincrement())
  invoiceNumber String   @unique // INV-YYYY-001
  month         String // December 2024
  year          Int
  totalProducts Int
  totalWeight   Float
  totalAmount   Float
  status        String   @default("Pending") // Pending, Paid
  generatedAt   DateTime @default(now())
  type          String   @default("Standard") // Standard, Wool

  @@map("invoice")
}

model DailyWool {
  id          Int         @id @default(autoincrement())
  date        String      @unique
  totalQty    Float       @default(0)
  totalWeight Float       @default(0)
  entries     WoolEntry[]
  createdAt   DateTime    @default(now())

  @@map("dailywool")
}

model WoolEntry {
  id          Int       @id @default(autoincrement())
  dailyWoolId Int
  dailyWool   DailyWool @relation(fields: [dailyWoolId], references: [id])
  category    String
  itemName    String
  uom         String
  qty         Float
  weight      Float

  @@map("woolentry")
}

enum users_role {
  admin
  tendor
  coordinator
  gola_maker
  artisan
}
